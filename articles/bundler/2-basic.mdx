---
title: 'webpack çš„åŸºæœ¬è§€å¿µå’Œä½¿ç”¨'
desc: 'åœ¨ä¸Šç¯‡æ–‡ç« ä¸­æˆ‘å€‘äº†è§£åˆ°äº† webpack çš„ç”±ä¾†ï¼Œé‚£ä»Šå¤©ä¾†æ›´æ·±å…¥çœ‹çœ‹ webpack åŸºæœ¬è§€å¿µå’Œä½¿ç”¨æ–¹æ³•å§ï¼'
date: '2023-08-31'
isActive: false
---

åœ¨ä¸Šç¯‡æ–‡ç« ä¸­æˆ‘å€‘äº†è§£åˆ°äº† webpack çš„ç”±ä¾†ï¼Œé‚£ä»Šå¤©ä¾†æ›´æ·±å…¥çœ‹çœ‹ webpack åŸºæœ¬è§€å¿µå’Œä½¿ç”¨æ–¹æ³•å§ï¼

é€™ç¯‡æ–‡ç« åˆ†åˆ¥æœƒä»‹ç´¹

1. å…¥å£
2. å‡ºå£
3. æ¨¡å¼
4. æ’ä»¶
5. è³‡æºæ¨¡çµ„
6. åŠ è¼‰å™¨

## `webpack.config.js` è¨­å®šæª”

åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘è¦æ‰“åŒ…ï¼Œéœ€è¦åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œä»¥ä¸‹ç¨‹å¼ç¢¼

```jsx
npx webpack ./index.js --mode=development
```

é™¤äº†æˆ‘å€‘æ‰‹å‹•æ‰“ä¸Šåç¨±å’Œæ¨¡å¼ï¼Œæˆ‘å€‘é‚„å¯ä»¥æ–°å¢ `webpack.config.js` è¨­å®šæª”ï¼Œä¾†èª¿æ•´ä¸€äº›åŸºæœ¬è¨­å®šï¼Œè®“æˆ‘å€‘ä¸ç”¨æ¯æ¬¡éƒ½æ‰“é€™éº¼é•·çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚æˆ‘å€‘å¯ä»¥è¨­å®šå…¥å£ä¾†æŒ‡å®šæˆ‘å€‘è¦æ‰“åŒ…çš„æª”æ¡ˆ

## å…¥å£ entry

é¦–å…ˆè¦è¨­å®šçš„æ˜¯å…¥å£ï¼Œå…¥å£æœƒå‘Šè¨´ webpack æˆ‘å€‘è¦æ‰“åŒ…æ¨¡çµ„çš„èµ·é»ï¼Œwebpack æœƒè‡ªå‹•æ ¹æ“šé€™å€‹æ¨¡çµ„çš„å¼•ç”¨ï¼Œä¸€èµ·æ‰“åŒ…å…¶å®ƒæª”æ¡ˆ

```jsx
// ./webpack.config.js
module.exports = {
  entry: './index.js',
};
```

## å‡ºå£ output

é™¤äº†å…¥å£ï¼Œwebpack ä¹Ÿå¯ä»¥è¨­å®šå‡ºå£ä¾†æŒ‡å®šæ‰“åŒ…å®Œçš„æª”æ¡ˆï¼Œé»˜èªæ˜¯æ”¾åœ¨ `./dist` æ–‡ä»¶å¤¾è£¡ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥æŒ‡å®šæª”æ¡ˆçš„åç¨±

```jsx
// ./webpack.config.js
const path = require('path');

module.exports = {
  entry: './index.js',
  output: {
    path: path.resolve(__dirname, 'public'), // ğŸ‘ˆ æŒ‡å®šçµ•å°è·¯å¾‘
    filename: 'main.bundle.js',
  },
};
```

å› ç‚º webpack æ˜¯é‹è¡Œåœ¨ node.js ä¸Šé¢ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ node.js çš„èªæ³•ä¾†æ±ºå®šè¼¸å‡ºçš„è·¯å¾‘

## æ¨¡å¼ mode

æˆ‘å€‘ä¹Ÿå¯ä»¥æä¾›æ¨¡å¼ï¼Œä¾†å‘Šè¨´ webpack ç•¶å‰çš„ç’°å¢ƒ

```jsx
const path = require('path');
module.exports = {
  entry: './index.js',
  output: {
    path: path.resolve(__dirname, 'public'),
    filename: 'main.bundle.js',
  },
  mode: 'development', // ğŸ‘ˆ æŒ‡å®šæ¨¡å¼
};
```

æ­¤æ™‚æˆ‘å€‘å·²ç¶“èª¿æ•´å¥½äº†å…¥å£ã€å‡ºå£ã€æ¨¡å¼ï¼Œå¦‚æœæˆ‘å€‘ä¿®æ”¹äº† index.js æª”éœ€è¦é‡æ–°æ‰“åŒ…æ™‚ï¼Œåªè¦åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥

```bash
npx webpack --watch
```

å°±ä¸ç”¨æ‰“ä¸Šå…¶å®ƒè³‡è¨Šäº†ï¼Œè€Œè¼¸å…¥å¢åŠ  --watchï¼Œwebpack å°±æœƒåœ¨æ›´æ”¹æª”æ¡ˆçš„æ™‚å€™ï¼Œè‡ªå‹•åŸ·è¡Œæ‰“åŒ…ã€‚

ä¸éæˆ‘å€‘é‡åˆ°äº†å¦ä¸€å€‹å•é¡Œï¼Œä¹Ÿå°±æ˜¯å°‡æ‰“åŒ…å®Œçš„æª”æ¡ˆåç¨±æ”¹æ‰å¾Œï¼Œæˆ‘å€‘è¦å›åˆ° `index.html` æª”æ‰‹å‹•æ›´æ”¹å¼•å…¥çš„æ‰“åŒ… JS æª”æ¡ˆ

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <script src="./public/main.bundle.js"></script>
    <!-- ğŸ‘† æ‰‹å‹•æ›´æ”¹ -->
  </head>
  <body>
    <h1>Hello from HTML</h1>
  </body>
</html>
```

é€™å€‹å•é¡Œæˆ‘å€‘å¯ä»¥é€éæ’ä»¶ä¾†è§£æ±ºã€‚

## æ’ä»¶ plugins

webpack æä¾›å„ç¨®æ’ä»¶ä¾†å¹«åŠ©æˆ‘å€‘é”åˆ°å„ç¨®åŠŸèƒ½ï¼Œä¾‹å¦‚èƒ½å¤ è§£æ±ºå‰é¢æ‰‹å‹•æ›´æ”¹æª”æ¡ˆåç¨±çš„ `html-webpack-plugin`ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°±ä¾†è©¦è‘—ä½¿ç”¨ä¸€äº›æ’ä»¶ç·´ç¿’ã€‚

æˆ‘å€‘å…ˆå®‰è£ `html-webpack-plugin` æ’ä»¶ï¼Œæ‰“é–‹çµ‚ç«¯æ©Ÿ

```bash
npm install html-webpack-plugin -D
```

æ¥è‘—æ‰“é–‹ `webpack.config.js` è¨­å®šæª”å¼•å…¥æ’ä»¶ï¼Œ

```jsx
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: './index.js',
  output: {
    path: path.resolve(__dirname, 'public'),
    filename: 'main.js',
  },
  plugins: [
    // ğŸ‘ˆ è¨˜å¾—åŠ  s
    new HtmlWebpackPlugin(),
  ],
};
```

æ­¤æ™‚å¯ä»¥ç™¼ç¾ public è£¡é¢å¤šäº†ä¸€å€‹ `index.html`ï¼Œè€Œä¸”è‡ªå‹•å¹«æˆ‘å€‘æ–°å¢äº†ä¸€å€‹ scriptï¼Œå¼•å…¥æ‰“åŒ…å®Œçš„ JS æª”æ¡ˆ

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Webpack App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script defer src="main.bundle.js"></script>
    <!-- ğŸ‘† æ’ä»¶æœƒè‡ªå‹•å¹«æˆ‘å€‘å¼•å…¥ -->
  </head>
  <body></body>
</html>
```

ä½†æˆ‘å€‘å¯ä»¥ç™¼ç¾ç¶²ç«™çš„æ¨™é¡Œä¸¦ä¸æ˜¯æˆ‘å€‘åŸæœ¬ `index.html` æ‰€è¨­å®šçš„ï¼Œé€™åªè¦åœ¨æ’ä»¶è£¡é¢èª¿æ•´æ¨¡æ¿å°±å¥½

```jsx
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: './index.js',
  output: {
    filename: 'main.bundle.js',
    path: path.resolve(__dirname, 'public'),
    clean: true, // ğŸ‘ˆ å°‡èˆŠçš„æ‰“åŒ…æª”æ¡ˆè‡ªå‹•åˆªé™¤
  },
  plugins: [
    // ğŸ‘ˆ è¨˜å¾—åŠ  s
    new HtmlWebpackPlugin({
      template: './index.html', // ğŸ‘ˆ è¨­å®šæ¨¡æ¿
    }),
  ],
};
```

æ­¤æ™‚ä»–å°±æœƒä¾æ“šåŸæœ¬çš„ html æª”å»ç”Ÿæˆæ–°çš„ html æª”æ¡ˆ

### ä½¿ç”¨ webpack-dev-server åŸ·è¡Œç†±æ›´æ–°

åˆ°ç¾åœ¨æˆ‘å€‘æ¯æ¬¡æ‰“åŒ…å®Œéƒ½éœ€è¦é‡æ–°æ•´ç†é é¢ï¼Œè‹¥å¸Œæœ›æ›´æ–°æª”æ¡ˆå¯¦è‡ªå‹•åˆ·æ–°ï¼Œåªè¦å®‰è£ `webpack-dev-server` å³å¯ï¼Œä¸€æ¨£æ‰“é–‹çµ‚ç«¯æ©Ÿè¼¸å…¥

```jsx
npm install webpack-dev-server -D
```

æ¥è‘—è¨­å®š webpack.config.jsï¼Œé€™è£¡è¦æ³¨æ„çš„æ˜¯ï¼Œå› ç‚ºç€è¦½å™¨æœ‰ç·©å­˜çš„ç‰¹æ€§ï¼Œæ‰€ä»¥å¦‚æœè¼¸å‡ºçš„æª”æ¡ˆåç¨±æ²’æœ‰è®Šï¼Œé‚£ç€è¦½å™¨å°±æœƒèªç‚ºæˆ‘å€‘çš„æª”æ¡ˆæ²’æœ‰è®Šï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨è¼¸å‡ºçš„æª”æ¡ˆåç¨±åŠ å…¥ `main.[contenthash].js` é€™æ¨£æ–‡ä»¶çš„åç¨±å°±æœƒæ ¹æ“šå…§å®¹æ”¹è®Šäº†

```jsx
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: './index.js',
  output: {
    path: path.resolve(__dirname, 'public'),
    filename: 'main.[contenthash].js', // ğŸ‘ˆ èª¿æ•´è¼¸å‡ºçš„æª”æ¡ˆåç¨±
    clean: true,
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './index.html',
    }),
  ],
  devServer: {
    static: {
      directory: path.join(__dirname, 'public'), // ğŸ‘ˆ è¨­å®šè·¯å¾‘
    },
  },
};
```

æ­¤æ™‚æˆ‘å€‘æ‰“é–‹çµ‚ç«¯æ©Ÿè¼¸å…¥

```jsx
npx webpack --watch
```

ä¸¦æ‰“é–‹å¦ä¸€å€‹çµ‚ç«¯æ©Ÿè¼¸å…¥

```jsx
npx webpack server
```

å°±å¯ä»¥è‡ªå‹•æ‰“åŒ…æª”æ¡ˆï¼Œä¸”ç•¶æˆ‘å€‘æ›´æ”¹æ–‡ä»¶æ™‚ï¼Œç€è¦½å™¨ä¹Ÿæœƒè‡ªå‹•åˆ·æ–°äº†

## è³‡æºæ¨¡çµ„ Asset Modules

åˆ°ç¾åœ¨æˆ‘å€‘éƒ½åªæœ‰æ‰“åŒ… JS æª”æ¡ˆï¼Œä¸é webpack ä¹Ÿå¯ä»¥å¼•å…¥å…¶ä»–è³‡æºï¼Œä¾‹å¦‚å­—é«”æª”æ¡ˆã€åœ–ç‰‡æª”æ¡ˆç­‰ç­‰ï¼Œåˆ†ç‚ºå››ç¨®

1. asset/resource : ç™¼é€å–®ç¨çš„æª”æ¡ˆä¸¦è‡ªå‹•å°å…¥ urlï¼Œå¯ç”¨åœ¨åœ–ç‰‡æª”
2. asset/inline : å°å‡ºè³‡æºçš„ uriï¼Œå¯ç”¨åœ¨ svg
3. asset/source : å°å‡ºè³‡æºçš„æºç¨‹å¼ç¢¼ï¼Œå¯ç”¨å­—æ–‡å­—æª”
4. asset : å°å‡ºè³‡æºçš„ uri å’Œæºç¨‹å¼ç¢¼

```jsx
// webpack.config.js
module.exports = {
  // ...

  module: {
    rules: [
      {
        test: /\.(png\jpg)$/, // ğŸ‘ˆ åˆ©ç”¨æ­£å‰‡åµæ¸¬æ–‡ä»¶
        type: 'asset/resource', // ğŸ‘ˆ æŒ‡å®šè³‡æºé¡å‹
      },
    ],
  },
};
```

è¨˜å¾—æ¯æ¬¡æ›´æ”¹ config æª”éƒ½è¦é‡æ–°å•Ÿå‹• webpack å’Œ webpack serverï¼Œæ­¤æ™‚æˆ‘å€‘å›åˆ° `index.js` å°±å¯ä»¥å¼•å…¥åœ–ç‰‡äº†

```jsx
// index.js
import imgSrc from './assets/webpack.jpg';

const img = document.createElement('img');
img.src = imgSrc;
document.querySelector('body').appendChild(img);
```

ä¹Ÿå¯ä»¥ç™¼ç¾æ‰“åŒ…å®Œçš„ public è³‡æ–™å¤¾è£¡é¢å¤šäº†ä¸€å€‹åœ–ç‰‡æª”æ¡ˆ

## loader

webpack çœŸæ­£å²å®³çš„åœ°æ–¹æ˜¯ï¼Œé™¤äº†è³‡æºæ¨¡çµ„ï¼Œå®ƒä¹Ÿå¯ä»¥é€é loader å¼•å…¥å…¶ä»–è³‡æºï¼Œä¾‹å¦‚ CSSã€SASS ç­‰ã€‚

å¯ä»¥çœ‹ä¸‹é¢é€™å¼µåœ–ä¾†çŸ¥é“ webpack æ‰®æ¼”çš„è§’è‰²ï¼Œç”±å…¥å£é–‹å§‹ï¼Œåˆ©ç”¨ loader å¼•å…¥å„ç¨®è³‡æºï¼Œç¶“é webpack å’Œæ’ä»¶ä¹‹å¾Œï¼Œæœƒæ‰“åŒ…å‡ºä¸€å€‹ JS æª”æ¡ˆ

![webpack3.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/88a92342-4add-47a3-8be6-5618244295e6/webpack3.jpg)

### åŠ è¼‰ CSS loader

æ¥è‘—æˆ‘å€‘å°±ä¾†çœ‹çœ‹ JS æ˜¯å¦‚ä½•å¼•å…¥ CSS æª”æ¡ˆçš„ã€‚

é¦–äº›æˆ‘å€‘ä¸€æ¨£è¦å…ˆå®‰è£ `css-loader`

```jsx
npm install css-loader -D
```

ä¸éé€™å€‹æ’ä»¶ loader åªèƒ½å¹«æˆ‘å€‘å¼•å…¥ css æª”ï¼Œä¸¦ä¸èƒ½å¹«æˆ‘å€‘å¢æ·»æ¨£å¼ï¼Œæ‰€ä»¥æˆ‘å€‘é‚„éœ€è¦åœ¨å®‰è£ä¸€å€‹ `style-loader`

```bash
npm install style-loader -D
```

æ¥è‘—æˆ‘å€‘èª¿æ•´ wepack.config.js

```jsx
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  // ...

  module: {
    rules: [
      {
        test: /\.(png|jpg)$/,
        type: 'asset/resource',
      },
      {
        test: /\.css$/, // ğŸ‘ˆ åˆ©ç”¨æ­£å‰‡åˆ¤æ–· css æª”æ¡ˆ
        use: ['style-loader', 'css-loader'], // ğŸ‘ˆ ä½¿ç”¨é™£åˆ—èªªæ˜è¦ä½¿ç”¨çš„ loader
      },
    ],
  },
};
```

é€™è£¡è¦æ³¨æ„çš„æ˜¯ï¼Œé™£åˆ—è£¡çš„é †åºä¸èƒ½åéä¾†ï¼Œå› ç‚º webpack æœƒç”±å¾Œå¾€å‰ä½¿ç”¨ loaderï¼Œæˆ‘å€‘å¿…é ˆè¦å…ˆç”¨ `css-loader` æ‰èƒ½ä½¿ç”¨ `style-loader`

æ¥è‘—æˆ‘å€‘å¯«ä¸€å€‹ index.cssï¼Œä¸¦åœ¨ index.js å¼•å…¥

```css
// ./index.css
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body,
html {
  height: 100%;
  font-family: sans-serif;
}

body {
  background: #222;
  color: #fff;
}
```

```jsx
// index.js
import imgSrc from './assets/webpack.jpg';
import './index.scss';

const img = document.createElement('img');
img.src = imgSrc;
document.querySelector('body').appendChild(img);
```

æ­¤æ™‚å°±å¯ä»¥ç™¼ç¾èƒŒæ™¯å’Œå­—é«”éƒ½æ”¹è®Šäº†ã€‚

### sass-loader

å¦‚æœæˆ‘å€‘æƒ³è¦å¯« sass/scssï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ webpack ä¾†æ‰“åŒ…ï¼Œé¦–å…ˆæˆ‘å€‘è¦å®‰è£ sass å’Œ sass-loader

```jsx
npm install sass -D
npm install sass-loader -D
```

```jsx
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: './index.js',
  output: {
    path: path.resolve(__dirname, 'public'),
    filename: 'main.[contenthash].js',
    clean: true,
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './index.html',
    }),
  ],
  devServer: {
    static: {
      directory: path.join(__dirname, 'public'),
    },
  },
  module: {
    rules: [
      {
        test: /\.(png|jpg)$/,
        type: 'asset/resource',
      },
      {
        test: /\.(css|scss|sass)$/, // ğŸ‘ˆ åˆ©ç”¨æ­£å‰‡åˆ¤æ–· scssã€sass æª”æ¡ˆ
        use: ['style-loader', 'css-loader', 'sass-loader'],
      },
    ],
  },
};
```

æ­¤æ™‚å°±å¯ä»¥ä½¿ç”¨ sass äº†

## å°çµ

ä»Šå¤©ä»‹ç´¹äº† webpack çš„åŸºç¤è§€å¿µï¼ŒåŒ…æ‹¬å…¥å£ã€å‡ºå£ã€æ’ä»¶ã€è³‡æºã€åŠ è¼‰å™¨ï¼Œå¸Œæœ›èƒ½è®“ä½ æ›´äº†è§£ webpack çš„æ‡‰ç”¨ã€‚
